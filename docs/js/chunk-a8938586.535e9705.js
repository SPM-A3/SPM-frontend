(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a8938586"],{"00b4":function(t,e,o){"use strict";o("ac1f");var a=o("23e7"),n=o("da84"),r=o("c65b"),i=o("e330"),s=o("1626"),c=o("861d"),d=function(){var t=!1,e=/[ac]/;return e.exec=function(){return t=!0,/./.exec.apply(this,arguments)},!0===e.test("abc")&&t}(),l=n.Error,u=i(/./.test);a({target:"RegExp",proto:!0,forced:!d},{test:function(t){var e=this.exec;if(!s(e))return u(this,t);var o=r(e,this,t);if(null!==o&&!c(o))throw new l("RegExp exec method returned something other than an Object or null");return!!o}})},"01a6":function(t,e,o){"use strict";o.r(e);var a=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("a-card",{attrs:{bordered:!1}},[o("a-col",{attrs:{span:16}},[o("a-row",[o("a-col",{attrs:{span:8}},[o("a-card",{staticStyle:{width:"500px"},attrs:{title:t.bookInfo.book_name,bordered:!1}},[o("div",[o("a-card-grid",{staticStyle:{width:"50%","text-align":"center","font-weight":"bold"}},[t._v(" ISBN: ")]),o("a-card-grid",{staticStyle:{width:"50%","text-align":"center"}},[t._v(" "+t._s(t.bookInfo.ISBN)+" ")])],1),o("div",[o("a-card-grid",{staticStyle:{width:"50%","text-align":"center","font-weight":"bold"}},[t._v(" Author: ")]),o("a-card-grid",{staticStyle:{width:"50%","text-align":"center"}},[t._v(" "+t._s(t.bookInfo.author)+" ")])],1),o("div",[o("a-card-grid",{staticStyle:{width:"50%","text-align":"center","font-weight":"bold"}},[t._v(" Category: ")]),o("a-card-grid",{staticStyle:{width:"50%","text-align":"center"}},[t._v(" "+t._s(t.bookInfo.category)+" ")])],1),o("div",[o("a-card-grid",{staticStyle:{width:"50%","text-align":"center","font-weight":"bold"}},[t._v(" Publisher: ")]),o("a-card-grid",{staticStyle:{width:"50%","text-align":"center"}},[t._v(" "+t._s(t.bookInfo.publisher)+" ")])],1),o("div",[o("a-card-grid",{staticStyle:{width:"50%","text-align":"center","font-weight":"bold"}},[t._v(" Published Time: ")]),o("a-card-grid",{staticStyle:{width:"50%","text-align":"center"}},[t._v(" "+t._s(t.bookInfo.published_time)+" ")])],1)])],1),o("a-col",{attrs:{offset:16}},[o("a-card",{staticStyle:{height:"300px",width:"300px"},attrs:{bordered:!1,size:"small"}},[o("a-radio-group",{attrs:{value:t.isReserved,"button-style":"solid"}},[o("a-radio-button",{attrs:{value:"a"},on:{click:function(e){return t.reserveBook()}}},[t._v("Reserved")]),o("a-radio-button",{attrs:{value:"b"},on:{click:function(e){return t.cancelReserveBook()}}},[t._v("Not Reserved")])],1),o("br"),o("br"),o("br"),o("p",[o("b",[t._v("Available Number: "+t._s(t.avail_book_number))]),t._v("  "),t.avail_book_number/t.book_number>=.5?o("a-tag",{attrs:{color:"green"}},[t._v("Adequate")]):t._e(),t.avail_book_number/t.book_number<.5?o("a-tag",{attrs:{color:"red"}},[t._v("Nervous")]):t._e()],1),o("a-progress",{staticStyle:{color:"green"},attrs:{type:"circle",width:150,percent:parseInt(t.avail_book_number/t.book_number*100),size:"small",status:"active"}})],1)],1)],1),o("a-row",[o("a-col",{attrs:{span:8}},[o("a-card",{staticStyle:{width:"750px",height:"200px","font-size":"20px"},attrs:{bordered:!1}},[t._v(" "+t._s(t.bookInfo.introduction)+" ")])],1)],1)],1),o("a-col",{attrs:{span:8}},[o("img",{attrs:{src:t.bookInfo.cover,alt:"img",height:"400"}})])],1),o("a-card",[o("a-table",{attrs:{columns:t.columns,"data-source":t.locationData,rowKey:"book_id"},scopedSlots:t._u([{key:"status",fn:function(e){return[0==e?o("a-tag",{attrs:{color:"green"}},[t._v("AVAILABLE")]):1==e?o("a-tag",{attrs:{color:"red"}},[t._v("LENT")]):-1==e?o("a-tag",{attrs:{color:"red"}},[t._v("LOST")]):-2==e?o("a-tag",{attrs:{color:"red"}},[t._v("DAMAGED")]):-3==e?o("a-tag",{attrs:{color:"gray"}},[t._v("UNAVAILABLE")]):t._e()]}},{key:"barcode",fn:function(e){return[o("vue-barcode",{attrs:{value:t.bookInfo.ISBN+"/"+e.book_id}})]}},{key:"operation",fn:function(e,a){return[o("a-space",{attrs:{direction:"vertical"}},[o("a-popconfirm",{attrs:{title:"Sure to Borrow?"},on:{confirm:function(){return t.borrowBook(a.book_id)}}},[0==a.status?o("a",{attrs:{href:"javascript:;"}},[t._v("BORROW")]):o("a",{attrs:{href:"javascript:;",disabled:"true"}},[t._v("BORROW")])]),o("a-dropdown",{attrs:{trigger:["click"]}},[o("a",{staticClass:"ant-dropdown-link"},[t._v(" Edit Book Status "),o("a-icon",{attrs:{type:"down"}})],1),o("a-menu",{attrs:{slot:"overlay"},on:{click:t.editCurr},slot:"overlay"},[o("a-menu-item",{key:"0"},[o("a-popconfirm",{attrs:{title:"Sure to Edit?"},on:{confirm:function(){return t.editBookStatus(a.book_id)}}},[o("a",{directives:[{name:"",rawName:"v-"}],attrs:{href:"javascript:;"}},[t._v("Available")])])],1),o("a-menu-item",{key:"1"},[o("a-popconfirm",{attrs:{title:"Sure to Edit?"},on:{confirm:function(){return t.editBookStatus(a.book_id)}}},[o("a",{directives:[{name:"",rawName:"v-"}],attrs:{href:"javascript:;"}},[t._v("Lent")])])],1),o("a-menu-item",{key:"-1"},[o("a-popconfirm",{attrs:{title:"Sure to Edit?"},on:{confirm:function(){return t.editBookStatus(a.book_id)}}},[o("a",{directives:[{name:"",rawName:"v-"}],attrs:{href:"javascript:;"}},[t._v("Lost")])])],1),o("a-menu-item",{key:"-2"},[o("a-popconfirm",{attrs:{title:"Sure to Edit?"},on:{confirm:function(){return t.editBookStatus(a.book_id)}}},[o("a",{directives:[{name:"",rawName:"v-"}],attrs:{href:"javascript:;"}},[t._v("Damaged")])])],1),o("a-menu-item",{key:"-3"},[o("a-popconfirm",{attrs:{title:"Sure to Edit?"},on:{confirm:function(){return t.editBookStatus(a.book_id)}}},[o("a",{directives:[{name:"",rawName:"v-"}],attrs:{href:"javascript:;"}},[t._v("Unavailable")])])],1)],1)],1)],1)]}}])})],1)],1)},n=[],r=o("b85c"),i=(o("e9c4"),o("d3b7"),o("99af"),o("fb6a"),o("93d6")),s=o("3723"),c=o.n(s),d=(o("7424"),[{title:"Book ID",dataIndex:"book_id",key:"book_id"},{title:"Room Number",dataIndex:"room_number",key:"room_number"},{title:"Bookshelf",dataIndex:"book_shelf",key:"book_shelf"},{title:"Side",dataIndex:"side",key:"side"},{title:"Layer",dataIndex:"layer",key:"layer"},{title:"Status",dataIndex:"status",key:"status",scopedSlots:{customRender:"status"}},{title:"Barcode",key:"barcode",scopedSlots:{customRender:"barcode"}},{title:"Operation",key:"operation",scopedSlots:{customRender:"operation"}}]),l={name:"Detail",components:{VueBarcode:c.a},data:function(){return{currentStatus:"0",checked1:!0,isReserved:"b",reservation_id:"",book_number:"",avail_book_number:"",locationData:[],columns:d,bookInfo:{ISBN:"",cover:"",book_name:"",introduction:"",publisher:"",published_time:"",author:"",category:""}}},methods:{clickpop:function(){this.visible=!0},cancleBtn:function(){this.visible=!1},changContent:function(){this.$router.push("/book/search").catch((function(t){console.log("输出报错",t)}))},getBookISBN:function(){return this.$route.params.id},reserveBook:function(){this.isReserved="a";var t={ISBN:this.getBookISBN()},e=new Headers({"Content-Type":"application/json"});e.append("token",Object(i["c"])());var o={method:"POST",headers:e,body:JSON.stringify(t)};fetch("".concat(this.$global.BASE_URL,"/api/user/reservation/add"),o).then((function(t){return t.json()})).then((function(t){console.log(t)})),this.$message.success("Book Reserve Successfully!"),this.visible=!1},cancelReserveBook:function(){this.isReserved="b";var t=new Headers({"Content-Type":"application/json"});t.append("token",Object(i["c"])());var e={method:"POST",headers:t,body:JSON.stringify({reservation_id:this.reservation_id})};fetch("".concat(this.$global.BASE_URL,"/api/user/reservation/cancel"),e).then((function(t){return t.json()})).then((function(t){console.log(t)})),this.$message.warning("Cancel Reservation Successfully!")},borrowBook:function(t){var e=this,o=this,a=new Headers({"Content-Type":"application/json"});a.append("token",Object(i["c"])());var n={method:"POST",headers:a,body:JSON.stringify({ISBN:this.getBookISBN(),book_id:t})};fetch("".concat(this.$global.BASE_URL,"/api/user/borrow"),n).then((function(t){return t.json()})).then((function(a){a.data;var n=a.code,i=a.msg;if(0===n){o.$message.success("Book Borrow Successfully!",1);var s,c=Object(r["a"])(e.locationData);try{for(c.s();!(s=c.n()).done;){var d=s.value;d.book_id==t&&(d.status=1)}}catch(h){c.e(h)}finally{c.f()}e.avail_book_number--;var l=a.data,u=new Headers;u.append("Content-Type","application/json");var f={method:"POST",headers:u,body:JSON.stringify({borrowing_number:l})};fetch("".concat(e.$global.EXTRA_FUNCTION,"/sendborrowingmsg"),f).then((function(t){return t.text()})).then((function(t){"success"===t&&console.log("成功发送借书通知")})).catch((function(t){o.$message.error("Failed to send notification. API call failed."),console.log(t)})),console.log(a)}else o.$message.error(i)})),this.visible=!1},deleteBook:function(t){console.log("book_id",t),console.log("ISBN",this.getBookISBN());var e=this,o=new Headers({"Content-Type":"application/json"});o.append("token",Object(i["c"])());var a={method:"Delete",headers:o,body:JSON.stringify({ISBN:this.getBookISBN(),book_id:t})};fetch("".concat(this.$global.BASE_URL,"/api/admin/book/deletecollection"),a).then((function(t){return t.json()})).then((function(t){console.log(t);t.data;var o=t.code;t.msg;0===o&&e.$message.success("Book Delete Successfully!")})),this.$router.go(0)},editBookStatus:function(t){console.log("book_id",t),console.log("ISBN",this.getBookISBN()),console.log("status",this.currentStatus);var e=this,o=new Headers({"Content-Type":"application/json"});o.append("token",Object(i["c"])());var a={method:"POST",headers:o,body:JSON.stringify({ISBN:this.getBookISBN(),book_id:t,status:this.currentStatus})};console.log(a),fetch("".concat(this.$global.BASE_URL,"/api/admin/book/editstatus"),a).then((function(t){return t.json()})).then((function(t){console.log(t);t.data;var o=t.code;t.msg;0===o&&e.$message.success("Book Edit Successfully!")})),this.$router.go(0)},editCurr:function(t){t.item;var e=t.key;t.keyPath;this.currentStatus=e,console.log(this.currentStatus)},getBookInfo:function(){var t=this;this.$global.BASE_URL;this.loading=!0;var e=new Headers;e.append("token",Object(i["c"])());var o={method:"GET",headers:e};fetch("".concat(this.$global.BASE_URL,"/api/admin/book/detail?ISBN=").concat(this.getBookISBN()),o).then((function(t){return t.json()})).then((function(e){console.log(e);var o=e.data[0];0==e.code&&(t.bookInfo.ISBN=o.iSBN,t.bookInfo.cover=o.cover,t.bookInfo.book_name=o.bookName,t.bookInfo.introduction=o.briefIntroduction,t.bookInfo.publisher=o.publisher,t.bookInfo.published_time=o.publishedTime.slice(0,7),t.bookInfo.author=o.author,t.bookInfo.category=o.category)})).catch((function(t){return console.log("error",t)}))},getBookLocations:function(){var t=this;this.loading=!0;var e=new Headers;e.append("token",Object(i["c"])());var o={method:"GET",headers:e},a=this;fetch("".concat(this.$global.BASE_URL,"/api/book/locations?ISBN=").concat(this.getBookISBN()),o).then((function(t){return t.json()})).then((function(e){if(console.log(e),0==e.code){t.book_number=e.data.length;var o,n=0,i=Object(r["a"])(e.data);try{for(i.s();!(o=i.n()).done;){var s=o.value;0==s.status&&n++}}catch(c){i.e(c)}finally{i.f()}t.avail_book_number=n,setTimeout((function(){var t,o=Object(r["a"])(e.data);try{for(o.s();!(t=o.n()).done;){var n=t.value;a.locationData.push({book_id:n.book_id,status:n.status,room_number:n.room_number,book_shelf:n.book_shelf,side:n.side,layer:n.layer})}}catch(c){o.e(c)}finally{o.f()}a.loading=!1}),200)}})).catch((function(t){return console.log("error",t)}))},getReservation:function(){var t=this,e=new Headers({"Content-Type":"application/json"});e.append("token",Object(i["c"])());var o={method:"GET",headers:e};fetch("".concat(this.$global.BASE_URL,"/api/reservation/"),o).then((function(t){return t.json()})).then((function(e){console.log(e);var o,a=Object(r["a"])(e.data);try{for(a.s();!(o=a.n()).done;){var n=o.value;n.ISBN==t.getBookISBN()&&(0==n.status?(t.isReserved="a",t.reservation_id=n.reservation_id):(t.isReserved="b",t.reservation_id=n.reservation_id))}}catch(i){a.e(i)}finally{a.f()}}))}},created:function(){this.id=this.getBookISBN(),this.getBookInfo(),this.getBookLocations(),this.getReservation()}},u=l,f=(o("0de3"),o("2877")),h=Object(f["a"])(u,a,n,!1,null,null,null);e["default"]=h.exports},"0de3":function(t,e,o){"use strict";o("e417")},"4df4":function(t,e,o){"use strict";var a=o("da84"),n=o("0366"),r=o("c65b"),i=o("7b0b"),s=o("9bdd"),c=o("e95a"),d=o("68ee"),l=o("07fa"),u=o("8418"),f=o("9a1f"),h=o("35a1"),b=a.Array;t.exports=function(t){var e=i(t),o=d(this),a=arguments.length,v=a>1?arguments[1]:void 0,g=void 0!==v;g&&(v=n(v,a>2?arguments[2]:void 0));var p,k,m,_,y,S,B=h(e),w=0;if(!B||this==b&&c(B))for(p=l(e),k=o?new this(p):b(p);p>w;w++)S=g?v(e[w],w):e[w],u(k,w,S);else for(_=f(e,B),y=_.next,k=o?new this:[];!(m=r(y,_)).done;w++)S=g?s(_,v,[m.value,w],!0):m.value,u(k,w,S);return k.length=w,k}},"99af":function(t,e,o){"use strict";var a=o("23e7"),n=o("da84"),r=o("d039"),i=o("e8b5"),s=o("861d"),c=o("7b0b"),d=o("07fa"),l=o("8418"),u=o("65f0"),f=o("1dde"),h=o("b622"),b=o("2d00"),v=h("isConcatSpreadable"),g=9007199254740991,p="Maximum allowed index exceeded",k=n.TypeError,m=b>=51||!r((function(){var t=[];return t[v]=!1,t.concat()[0]!==t})),_=f("concat"),y=function(t){if(!s(t))return!1;var e=t[v];return void 0!==e?!!e:i(t)},S=!m||!_;a({target:"Array",proto:!0,forced:S},{concat:function(t){var e,o,a,n,r,i=c(this),s=u(i,0),f=0;for(e=-1,a=arguments.length;e<a;e++)if(r=-1===e?i:arguments[e],y(r)){if(n=d(r),f+n>g)throw k(p);for(o=0;o<n;o++,f++)o in r&&l(s,f,r[o])}else{if(f>=g)throw k(p);l(s,f++,r)}return s.length=f,s}})},"9bdd":function(t,e,o){var a=o("825a"),n=o("2a62");t.exports=function(t,e,o,r){try{return r?e(a(o)[0],o[1]):e(o)}catch(i){n(t,"throw",i)}}},a630:function(t,e,o){var a=o("23e7"),n=o("4df4"),r=o("1c7e"),i=!r((function(t){Array.from(t)}));a({target:"Array",stat:!0,forced:i},{from:n})},b85c:function(t,e,o){"use strict";o.d(e,"a",(function(){return r}));o("a4d3"),o("e01a"),o("d3b7"),o("d28b"),o("3ca3"),o("ddb0"),o("fb6a"),o("b0c0"),o("a630"),o("ac1f"),o("00b4");function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,a=new Array(e);o<e;o++)a[o]=t[o];return a}function n(t,e){if(t){if("string"===typeof t)return a(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?a(t,e):void 0}}function r(t,e){var o="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=n(t))||e&&t&&"number"===typeof t.length){o&&(t=o);var a=0,r=function(){};return{s:r,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,c=!1;return{s:function(){o=o.call(t)},n:function(){var t=o.next();return s=t.done,t},e:function(t){c=!0,i=t},f:function(){try{s||null==o["return"]||o["return"]()}finally{if(c)throw i}}}}},d28b:function(t,e,o){var a=o("746f");a("iterator")},e417:function(t,e,o){}}]);
//# sourceMappingURL=chunk-a8938586.535e9705.js.map