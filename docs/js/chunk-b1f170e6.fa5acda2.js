(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b1f170e6"],{"00b4":function(t,e,o){"use strict";o("ac1f");var n=o("23e7"),r=o("da84"),a=o("c65b"),i=o("e330"),s=o("1626"),c=o("861d"),d=function(){var t=!1,e=/[ac]/;return e.exec=function(){return t=!0,/./.exec.apply(this,arguments)},!0===e.test("abc")&&t}(),l=r.Error,u=i(/./.test);n({target:"RegExp",proto:!0,forced:!d},{test:function(t){var e=this.exec;if(!s(e))return u(this,t);var o=a(e,this,t);if(null!==o&&!c(o))throw new l("RegExp exec method returned something other than an Object or null");return!!o}})},"47fd":function(t,e,o){},"4df4":function(t,e,o){"use strict";var n=o("da84"),r=o("0366"),a=o("c65b"),i=o("7b0b"),s=o("9bdd"),c=o("e95a"),d=o("68ee"),l=o("07fa"),u=o("8418"),f=o("9a1f"),b=o("35a1"),h=n.Array;t.exports=function(t){var e=i(t),o=d(this),n=arguments.length,v=n>1?arguments[1]:void 0,g=void 0!==v;g&&(v=r(v,n>2?arguments[2]:void 0));var p,k,_,y,m,S,w=b(e),B=0;if(!w||this==h&&c(w))for(p=l(e),k=o?new this(p):h(p);p>B;B++)S=g?v(e[B],B):e[B],u(k,B,S);else for(y=f(e,w),m=y.next,k=o?new this:[];!(_=a(m,y)).done;B++)S=g?s(y,v,[_.value,B],!0):_.value,u(k,B,S);return k.length=B,k}},"5fb1":function(t,e,o){"use strict";o.r(e);var n=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("a-card",{attrs:{bordered:!1}},[o("a-col",{attrs:{span:16}},[o("a-row",[o("a-col",{attrs:{span:8}},[o("a-card",{staticStyle:{width:"500px"},attrs:{title:t.bookInfo.book_name,bordered:!1}},[o("div",[o("a-card-grid",{staticStyle:{width:"50%","text-align":"center","font-weight":"bold"}},[t._v(" ISBN: ")]),o("a-card-grid",{staticStyle:{width:"50%","text-align":"center"}},[t._v(" "+t._s(t.bookInfo.ISBN)+" ")])],1),o("div",[o("a-card-grid",{staticStyle:{width:"50%","text-align":"center","font-weight":"bold"}},[t._v(" Author: ")]),o("a-card-grid",{staticStyle:{width:"50%","text-align":"center"}},[t._v(" "+t._s(t.bookInfo.author)+" ")])],1),o("div",[o("a-card-grid",{staticStyle:{width:"50%","text-align":"center","font-weight":"bold"}},[t._v(" Category: ")]),o("a-card-grid",{staticStyle:{width:"50%","text-align":"center"}},[t._v(" "+t._s(t.bookInfo.category)+" ")])],1),o("div",[o("a-card-grid",{staticStyle:{width:"50%","text-align":"center","font-weight":"bold"}},[t._v(" Publisher: ")]),o("a-card-grid",{staticStyle:{width:"50%","text-align":"center"}},[t._v(" "+t._s(t.bookInfo.publisher)+" ")])],1),o("div",[o("a-card-grid",{staticStyle:{width:"50%","text-align":"center","font-weight":"bold"}},[t._v(" Published Time: ")]),o("a-card-grid",{staticStyle:{width:"50%","text-align":"center"}},[t._v(" "+t._s(t.bookInfo.published_time)+" ")])],1)])],1),o("a-col",{attrs:{offset:16}},[o("a-card",{staticStyle:{height:"300px",width:"300px"},attrs:{bordered:!1,size:"small"}},[o("a-radio-group",{attrs:{value:t.isReserved,"button-style":"solid"}},[o("a-radio-button",{attrs:{value:"a"},on:{click:function(e){return t.reserveBook()}}},[t._v("Reserved")]),o("a-radio-button",{attrs:{value:"b"},on:{click:function(e){return t.cancelReserveBook()}}},[t._v("Not Reserved")])],1),o("br"),o("br"),o("br"),o("p",[o("b",[t._v("Available Number: "+t._s(t.avail_book_number))]),t._v("  "),t.avail_book_number/t.book_number>=.5?o("a-tag",{attrs:{color:"green"}},[t._v("Adequate")]):t._e(),t.avail_book_number/t.book_number<.5?o("a-tag",{attrs:{color:"red"}},[t._v("Nervous")]):t._e()],1),o("a-progress",{staticStyle:{color:"green"},attrs:{type:"circle",width:150,percent:parseInt(t.avail_book_number/t.book_number*100),size:"small",status:"active"}})],1)],1)],1),o("a-row",[o("a-col",{attrs:{span:8}},[o("a-card",{staticStyle:{width:"750px",height:"200px","font-size":"20px"},attrs:{bordered:!1}},[t._v(" "+t._s(t.bookInfo.introduction)+" ")])],1)],1)],1),o("a-col",{attrs:{span:8}},[o("img",{attrs:{src:t.bookInfo.cover,alt:"img",height:"400"}})])],1),o("a-card",[o("a-table",{attrs:{columns:t.columns,"data-source":t.locationData,rowKey:"book_id"},scopedSlots:t._u([{key:"status",fn:function(e){return[0==e?o("a-tag",{attrs:{color:"green"}},[t._v("Available")]):1==e?o("a-tag",{attrs:{color:"red"}},[t._v("Lent")]):t._e()]}},{key:"barcode",fn:function(e){return[o("vue-barcode",{attrs:{value:t.bookInfo.ISBN+"/"+e.book_id}})]}},{key:"operation",fn:function(e,n){return[o("a-popconfirm",{attrs:{title:"Sure to Borrow?"},on:{confirm:function(){return t.borrowBook(n.book_id)}}},[0==n.status?o("a",{attrs:{href:"javascript:;"}},[t._v("BORROW")]):1==n.status?o("a",{attrs:{href:"javascript:;",disabled:"true"}},[t._v("BORROW")]):t._e()])]}}])})],1)],1)},r=[],a=o("b85c"),i=(o("e9c4"),o("d3b7"),o("99af"),o("fb6a"),o("93d6")),s=o("3723"),c=o.n(s),d=(o("7424"),[{title:"Book ID",dataIndex:"book_id",key:"book_id"},{title:"Room Number",dataIndex:"room_number",key:"room_number"},{title:"Bookshelf",dataIndex:"book_shelf",key:"book_shelf"},{title:"Side",dataIndex:"side",key:"side"},{title:"Layer",dataIndex:"layer",key:"layer"},{title:"Status",dataIndex:"status",key:"status",scopedSlots:{customRender:"status"}},{title:"Barcode",key:"barcode",scopedSlots:{customRender:"barcode"}},{title:"Operation",key:"operation",scopedSlots:{customRender:"operation"}}]),l={name:"Detail",components:{VueBarcode:c.a},data:function(){return{checked1:!0,isReserved:"b",reservation_id:"",book_number:"",avail_book_number:"",locationData:[],columns:d,bookInfo:{ISBN:"",cover:"",book_name:"",introduction:"",publisher:"",published_time:"",author:"",category:""}}},methods:{clickpop:function(){this.visible=!0},cancleBtn:function(){this.visible=!1},changeContent:function(){this.$router.push("/book/search").catch((function(t){console.log("输出报错",t)}))},getBookISBN:function(){return this.$route.params.id},reserveBook:function(){this.isReserved="a";var t={ISBN:this.getBookISBN()},e=new Headers({"Content-Type":"application/json"});e.append("token",Object(i["c"])());var o={method:"POST",headers:e,body:JSON.stringify(t)};fetch("".concat(this.$global.BASE_URL,"/api/user/reservation/add"),o).then((function(t){return t.json()})).then((function(t){console.log(t)})),this.$message.success("Book Reserve Successfully!"),this.visible=!1},cancelReserveBook:function(){this.isReserved="b";var t=new Headers({"Content-Type":"application/json"});t.append("token",Object(i["c"])());var e={method:"POST",headers:t,body:JSON.stringify({reservation_id:this.reservation_id})};fetch("".concat(this.$global.BASE_URL,"/api/user/reservation/cancel"),e).then((function(t){return t.json()})).then((function(t){console.log(t)})),this.$message.warning("Cancel Reservation Successfully!")},borrowBook:function(t){var e=this,o=this,n=new Headers({"Content-Type":"application/json"});n.append("token",Object(i["c"])());var r={method:"POST",headers:n,body:JSON.stringify({ISBN:this.getBookISBN(),book_id:t})};fetch("".concat(this.$global.BASE_URL,"/api/user/borrow"),r).then((function(t){return t.json()})).then((function(n){n.data;var r=n.code,i=n.msg;if(0===r){o.$message.success("Book Borrow Successfully!",1);var s,c=Object(a["a"])(e.locationData);try{for(c.s();!(s=c.n()).done;){var d=s.value;d.book_id==t&&(d.status=1)}}catch(b){c.e(b)}finally{c.f()}e.avail_book_number--;var l=n.data,u=new Headers;u.append("Content-Type","application/json");var f={method:"POST",headers:u,body:JSON.stringify({borrowing_number:l})};fetch("".concat(e.$global.EXTRA_FUNCTION,"/sendborrowingmsg"),f).then((function(t){return t.text()})).then((function(t){"success"===t&&console.log("成功发送借书通知")})).catch((function(t){o.$message.error("Failed to send notification. API call failed."),console.log(t)})),console.log(n)}else o.$message.error(i)})),this.visible=!1},getBookInfo:function(){var t=this;this.loading=!0;var e=new Headers;e.append("token",Object(i["c"])());var o={method:"GET",headers:e};fetch("".concat(this.$global.BASE_URL,"/api/admin/book/detail?ISBN=").concat(this.getBookISBN()),o).then((function(t){return t.json()})).then((function(e){console.log(e);var o=e.data[0];0==e.code&&(t.bookInfo.ISBN=o.iSBN,t.bookInfo.cover=o.cover,t.bookInfo.book_name=o.bookName,t.bookInfo.introduction=o.briefIntroduction,t.bookInfo.publisher=o.publisher,t.bookInfo.published_time=o.publishedTime.slice(0,7),t.bookInfo.author=o.author,t.bookInfo.category=o.category)})).catch((function(t){return console.log("error",t)}))},getBookLocations:function(){var t=this;this.loading=!0;var e=new Headers;e.append("token",Object(i["c"])());var o={method:"GET",headers:e},n=this;fetch("".concat(this.$global.BASE_URL,"/api/book/locations?ISBN=").concat(this.getBookISBN()),o).then((function(t){return t.json()})).then((function(e){if(console.log(e),0==e.code){t.book_number=e.data.length;var o,r=0,i=Object(a["a"])(e.data);try{for(i.s();!(o=i.n()).done;){var s=o.value;0==s.status&&r++}}catch(c){i.e(c)}finally{i.f()}t.avail_book_number=r,setTimeout((function(){var t,o=Object(a["a"])(e.data);try{for(o.s();!(t=o.n()).done;){var r=t.value;n.locationData.push({book_id:r.book_id,status:r.status,room_number:r.room_number,book_shelf:r.book_shelf,side:r.side,layer:r.layer})}}catch(c){o.e(c)}finally{o.f()}n.loading=!1}),200)}})).catch((function(t){return console.log("error",t)}))},getReservation:function(){var t=this,e=new Headers({"Content-Type":"application/json"});e.append("token",Object(i["c"])());var o={method:"GET",headers:e};fetch("".concat(this.$global.BASE_URL,"/api/reservation/"),o).then((function(t){return t.json()})).then((function(e){console.log(e);var o,n=Object(a["a"])(e.data);try{for(n.s();!(o=n.n()).done;){var r=o.value;r.ISBN==t.getBookISBN()&&(0==r.status?(t.isReserved="a",t.reservation_id=r.reservation_id):(t.isReserved="b",t.reservation_id=r.reservation_id))}}catch(i){n.e(i)}finally{n.f()}}))}},created:function(){this.id=this.getBookISBN(),this.getBookInfo(),this.getBookLocations(),this.getReservation()}},u=l,f=(o("8ee4"),o("2877")),b=Object(f["a"])(u,n,r,!1,null,null,null);e["default"]=b.exports},"8ee4":function(t,e,o){"use strict";o("47fd")},"99af":function(t,e,o){"use strict";var n=o("23e7"),r=o("da84"),a=o("d039"),i=o("e8b5"),s=o("861d"),c=o("7b0b"),d=o("07fa"),l=o("8418"),u=o("65f0"),f=o("1dde"),b=o("b622"),h=o("2d00"),v=b("isConcatSpreadable"),g=9007199254740991,p="Maximum allowed index exceeded",k=r.TypeError,_=h>=51||!a((function(){var t=[];return t[v]=!1,t.concat()[0]!==t})),y=f("concat"),m=function(t){if(!s(t))return!1;var e=t[v];return void 0!==e?!!e:i(t)},S=!_||!y;n({target:"Array",proto:!0,forced:S},{concat:function(t){var e,o,n,r,a,i=c(this),s=u(i,0),f=0;for(e=-1,n=arguments.length;e<n;e++)if(a=-1===e?i:arguments[e],m(a)){if(r=d(a),f+r>g)throw k(p);for(o=0;o<r;o++,f++)o in a&&l(s,f,a[o])}else{if(f>=g)throw k(p);l(s,f++,a)}return s.length=f,s}})},"9bdd":function(t,e,o){var n=o("825a"),r=o("2a62");t.exports=function(t,e,o,a){try{return a?e(n(o)[0],o[1]):e(o)}catch(i){r(t,"throw",i)}}},a630:function(t,e,o){var n=o("23e7"),r=o("4df4"),a=o("1c7e"),i=!a((function(t){Array.from(t)}));n({target:"Array",stat:!0,forced:i},{from:r})},b85c:function(t,e,o){"use strict";o.d(e,"a",(function(){return a}));o("a4d3"),o("e01a"),o("d3b7"),o("d28b"),o("3ca3"),o("ddb0"),o("fb6a"),o("b0c0"),o("a630"),o("ac1f"),o("00b4");function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,n=new Array(e);o<e;o++)n[o]=t[o];return n}function r(t,e){if(t){if("string"===typeof t)return n(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?n(t,e):void 0}}function a(t,e){var o="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=r(t))||e&&t&&"number"===typeof t.length){o&&(t=o);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,c=!1;return{s:function(){o=o.call(t)},n:function(){var t=o.next();return s=t.done,t},e:function(t){c=!0,i=t},f:function(){try{s||null==o["return"]||o["return"]()}finally{if(c)throw i}}}}},d28b:function(t,e,o){var n=o("746f");n("iterator")}}]);
//# sourceMappingURL=chunk-b1f170e6.fa5acda2.js.map