(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d9f96d9e"],{1276:function(e,t,n){"use strict";var r=n("2ba4"),a=n("c65b"),o=n("e330"),i=n("d784"),s=n("44e7"),l=n("825a"),u=n("1d80"),c=n("4840"),d=n("8aa5"),p=n("50c4"),m=n("577e"),f=n("dc4a"),g=n("4dae"),h=n("14c3"),v=n("9263"),b=n("9f7f"),w=n("d039"),y=b.UNSUPPORTED_Y,_=4294967295,x=Math.min,I=[].push,C=o(/./.exec),P=o(I),N=o("".slice),E=!w((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2!==n.length||"a"!==n[0]||"b"!==n[1]}));i("split",(function(e,t,n){var o;return o="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,n){var o=m(u(this)),i=void 0===n?_:n>>>0;if(0===i)return[];if(void 0===e)return[o];if(!s(e))return a(t,o,e,i);var l,c,d,p=[],f=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),h=0,b=new RegExp(e.source,f+"g");while(l=a(v,b,o)){if(c=b.lastIndex,c>h&&(P(p,N(o,h,l.index)),l.length>1&&l.index<o.length&&r(I,p,g(l,1)),d=l[0].length,h=c,p.length>=i))break;b.lastIndex===l.index&&b.lastIndex++}return h===o.length?!d&&C(b,"")||P(p,""):P(p,N(o,h)),p.length>i?g(p,0,i):p}:"0".split(void 0,0).length?function(e,n){return void 0===e&&0===n?[]:a(t,this,e,n)}:t,[function(t,n){var r=u(this),i=void 0==t?void 0:f(t,e);return i?a(i,t,r,n):a(o,m(r),t,n)},function(e,r){var a=l(this),i=m(e),s=n(o,a,i,r,o!==t);if(s.done)return s.value;var u=c(a,RegExp),f=a.unicode,g=(a.ignoreCase?"i":"")+(a.multiline?"m":"")+(a.unicode?"u":"")+(y?"g":"y"),v=new u(y?"^(?:"+a.source+")":a,g),b=void 0===r?_:r>>>0;if(0===b)return[];if(0===i.length)return null===h(v,i)?[i]:[];var w=0,I=0,C=[];while(I<i.length){v.lastIndex=y?0:I;var E,S=h(v,y?N(i,I):i);if(null===S||(E=x(p(v.lastIndex+(y?I:0)),i.length))===w)I=d(i,I,f);else{if(P(C,N(i,w,I)),C.length===b)return C;for(var T=1;T<=S.length-1;T++)if(P(C,S[T]),C.length===b)return C;I=w=E}}return P(C,N(i,w)),C}]}),!E,y)},"14c3":function(e,t,n){var r=n("da84"),a=n("c65b"),o=n("825a"),i=n("1626"),s=n("c6b6"),l=n("9263"),u=r.TypeError;e.exports=function(e,t){var n=e.exec;if(i(n)){var r=a(n,e,t);return null!==r&&o(r),r}if("RegExp"===s(e))return a(l,e,t);throw u("RegExp#exec called on incompatible receiver")}},"177c":function(e,t,n){"use strict";n("42bb")},"364e":function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a-layout",{staticStyle:{background:"#fff",height:"100%"}},[n("a-layout-sider",{staticStyle:{background:"#fff"},attrs:{width:"200"}},[n("a-menu",{staticStyle:{height:"100%"},attrs:{mode:"inline","default-selected-keys":["1"]}},[n("a-menu-item",{key:"1",on:{click:function(t){return e.changeContent(1)}}},[e._v("UserInfo")]),n("a-menu-item",{key:"2",on:{click:function(t){return e.changeContent(2)}}},[e._v("Notifications")])],1)],1),n("a-layout-content",{style:{padding:"0 24px",minHeight:"50vh"}},[1==e.contentNumber?n("div",[[n("div",{staticStyle:{margin:"0 auto","text-align":"center"}},[n("a-avatar",{attrs:{size:100,src:e.userInfo.avatar}})],1),n("br"),n("a-descriptions",{staticStyle:{"margin-right":"150px","margin-left":"150px"},attrs:{title:"User Info",bordered:""}},[n("a-descriptions-item",{attrs:{label:"Barcode",span:3}},[n("vue-qr",{staticStyle:{width:"100px",height:"100px"},attrs:{text:e.userInfo.user_id,qid:"testid"}})],1),n("a-descriptions-item",{attrs:{label:"ID",span:3}},[e._v(e._s(e.userInfo.id))]),n("a-descriptions-item",{attrs:{label:"Nickname",span:3}},[e._v(e._s(e.userInfo.name))]),n("a-descriptions-item",{attrs:{label:"Gender",span:3}},[0==e.userInfo.gender?n("div",[e._v(" Male ")]):n("div",[e._v(" Female ")])]),n("a-descriptions-item",{attrs:{label:"Position",span:3}},[0==e.userInfo.position?n("div",[e._v(" Student ")]):1==e.userInfo.position?n("div",[e._v(" Teacher ")]):n("div",[e._v(" Staff ")])]),n("a-descriptions-item",{attrs:{label:"Phone Number",span:3}},[e._v(e._s(e.userInfo.phone_number))]),n("a-descriptions-item",{attrs:{label:"E-mail",span:3}},[e._v(e._s(e.userInfo.email))]),n("a-descriptions-item",{attrs:{label:"Borrowing",span:3}},[e._v(e._s(e.userInfo.borrowing))]),n("a-descriptions-item",{attrs:{label:"Borrowing limit",span:3}},[e._v(e._s(e.userInfo.maxBorrowing))])],1),n("br"),n("div",{staticStyle:{margin:"0 auto","text-align":"center"}},[n("a-space",[n("a-button",{attrs:{type:"primary"},on:{click:function(t){return e.changeContent(3)}}},[e._v("Edit")]),n("a-button",{attrs:{type:"dashed"},on:{click:e.handleLogout}},[e._v("Logout")])],1)],1)]],2):2==e.contentNumber?n("div",[[n("a-list",{attrs:{"item-layout":"horizontal","data-source":e.notifications},scopedSlots:e._u([{key:"renderItem",fn:function(t){return n("a-list-item",{},[n("a-list-item-meta",{attrs:{description:t.content+"  "+t.time}},[n("a",{attrs:{slot:"title",href:"/#"+t.url},slot:"title"},[e._v(e._s(t.title))])]),n("a-button",{attrs:{type:"primary"},on:{click:function(n){return e.goto(t.url)}}},[e._v("Detail")])],1)}}])})]],2):3==e.contentNumber?n("div",[n("EditProfile",{attrs:{userId:this.userInfo.user_id}})],1):e._e()])],1)},a=[],o=n("b85c"),i=(n("e9c4"),n("d3b7"),n("b0c0"),n("99af"),n("93d6")),s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a-form",{attrs:{form:e.form},on:{submit:e.handleSubmit}},[n("a-form-item",{attrs:{label:"avatar",labelCol:{span:7},wrapperCol:{span:10}}},[n("a-upload",{staticClass:"avatar-uploader",attrs:{name:"avatar","list-type":"picture-card","show-upload-list":!1,customRequest:e.upload}},[e.imageUrl?n("img",{attrs:{src:e.imageUrl,alt:"avatar"}}):n("div",[n("a-icon",{attrs:{type:e.uploading?"loading":"plus"}}),n("div",{staticClass:"ant-upload-text"},[e._v("UPDATE AVATAR")])],1)])],1),n("a-form-item",{attrs:{label:"UID",labelCol:{span:7},wrapperCol:{span:10}}},[n("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["user_id"],expression:"[\n        'user_id',\n      ]"}],attrs:{disabled:""}})],1),n("a-form-item",{attrs:{label:"ID",labelCol:{span:7},wrapperCol:{span:10}}},[n("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["id",{rules:[{required:!0,message:"Please input your ID!"}]}],expression:"[\n        'id',\n        {\n          rules: [\n            {\n              required: true,\n              message: 'Please input your ID!',\n            },\n          ],\n        },\n      ]"}]})],1),n("a-form-item",{attrs:{label:"E-mail",labelCol:{span:7},wrapperCol:{span:10}}},[n("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["email",{rules:[{type:"email",message:"The input is not valid E-mail!"},{required:!0,message:"Please input your E-mail!"}]}],expression:"[\n        'email',\n        {\n          rules: [\n            {\n              type: 'email',\n              message: 'The input is not valid E-mail!',\n            },\n            {\n              required: true,\n              message: 'Please input your E-mail!',\n            },\n          ],\n        },\n      ]"}]})],1),n("a-form-item",{attrs:{label:"Password","has-feedback":"",labelCol:{span:7},wrapperCol:{span:10}}},[n("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["password",{rules:[{required:!0,message:"Please input your password!"},{validator:e.validateToNextPassword}]}],expression:"[\n        'password',\n        {\n          rules: [\n            {\n              required: true,\n              message: 'Please input your password!',\n            },\n            {\n              validator: validateToNextPassword,\n            },\n          ],\n        },\n      ]"}],attrs:{type:"password"}})],1),n("a-form-item",{attrs:{label:"Confirm Password","has-feedback":"",labelCol:{span:7},wrapperCol:{span:10}}},[n("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["confirm",{rules:[{required:!0,message:"Please confirm your password!"},{validator:e.compareToFirstPassword}]}],expression:"[\n        'confirm',\n        {\n          rules: [\n            {\n              required: true,\n              message: 'Please confirm your password!',\n            },\n            {\n              validator: compareToFirstPassword,\n            },\n          ],\n        },\n      ]"}],attrs:{type:"password"},on:{blur:e.handleConfirmBlur}})],1),n("a-form-item",{attrs:{labelCol:{span:7},wrapperCol:{span:10}}},[n("span",{attrs:{slot:"label"},slot:"label"},[e._v(" Name ")]),n("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,message:"Please input your name!",whitespace:!0}]}],expression:"[\n        'name',\n        {\n          rules: [\n            {\n              required: true,\n              message: 'Please input your name!',\n              whitespace: true,\n            },\n          ],\n        },\n      ]"}]})],1),n("a-form-item",{attrs:{label:"gender",labelCol:{span:7},wrapperCol:{span:10}}},[n("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["gender",{rules:[{required:!0,message:"Please select your gender!",whitespace:!0,type:"number"}]}],expression:"[\n        'gender',\n        {\n          rules: [\n            {\n              required: true,\n              message: 'Please select your gender!',\n              whitespace: true,\n              type: 'number',\n            },\n          ],\n        },\n      ]"}]},[n("a-select-option",{attrs:{value:0}},[e._v(" Male ")]),n("a-select-option",{attrs:{value:1}},[e._v(" Female ")])],1)],1),n("a-form-item",{attrs:{label:"Position",labelCol:{span:7},wrapperCol:{span:10}}},[n("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["position",{rules:[{required:!0,message:"Please select your position!",whitespace:!0,type:"number"}]}],expression:"[\n        'position',\n        {\n          rules: [\n            {\n              required: true,\n              message: 'Please select your position!',\n              whitespace: true,\n              type: 'number',\n            },\n          ],\n        },\n      ]"}]},[n("a-select-option",{attrs:{value:0}},[e._v(" Student ")]),n("a-select-option",{attrs:{value:1}},[e._v(" Teacher ")]),n("a-select-option",{attrs:{value:2}},[e._v(" Staff ")])],1)],1),n("a-form-item",{attrs:{label:"Phone Number",labelCol:{span:7},wrapperCol:{span:10}}},[n("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["phone_number",{rules:[{required:!0,message:"Please input your phone number!"}]}],expression:"[\n        'phone_number',\n        {\n          rules: [\n            { required: true, message: 'Please input your phone number!' },\n          ],\n        },\n      ]"}],staticStyle:{width:"100%"}})],1),n("a-form-item",{staticStyle:{"margin-top":"24px"},attrs:{wrapperCol:{span:10,offset:7}}},[n("a-space",[n("a-button",{attrs:{loading:e.loading,type:"primary","html-type":"submit"}},[e._v("UPDATE")]),n("a-button",{on:{click:function(t){return e.$router.push("/user/profile")}}},[e._v("CANCEL")])],1)],1)],1)},l=[],u=n("5530");n("ac1f"),n("1276"),n("25f0");function c(e,t){var n=new FileReader;n.addEventListener("load",(function(){return t(n.result)})),n.readAsDataURL(e)}var d={name:"EditProfile",props:["userId"],data:function(){return{confirmDirty:!1,autoCompleteResult:[],uploading:!1,loading:!1,imageUrl:"",newUserInfo:{id:"",name:"",avatar:"",gender:-1,position:-1,email:"",phone_number:"",password:""},alert:{showAlert:!1,type:"warning",message:""}}},beforeCreate:function(){this.form=this.$form.createForm(this,{name:"userAdd"})},created:function(){var e=this,t=new Headers;t.append("token",Object(i["c"])());var n={method:"GET",headers:t},r=this;fetch("".concat(this.$global.BASE_URL,"/api/admin/user/detail?user_id=").concat(this.userId),n).then((function(e){return e.json()})).then((function(t){var n=t.code,a=(t.msg,t.data);if(0==n&&"null"!=a[0]){var o=a[0];e.form.setFieldsValue({user_id:o.userId,id:o.id,phone_number:o.phoneNumber,gender:o.gender,name:o.name,position:o.position,password:o.password,confirm:o.password,email:o.email}),r.imageUrl=o.avatar}})).catch((function(e){return console.log("error",e)}))},methods:{handleUpdate:function(e){var t=this;"uploading"!==e.file.status?"done"===e.file.status&&c(e.file.originFileObj,(function(e){t.imageUrl=e,t.loading=!1})):this.loading=!0},upload:function(e){var t=this;this.uploading=!0;var n=new FileReader;n.readAsDataURL(e.file),n.onloadend=function(e){var n=e.target.result.toString().split(",")[1];if(e&&e.target&&e.target.result){var r=n,a={method:"POST",body:r};fetch("https://service-rb270dgm-1301774019.gz.apigw.tencentcs.com/release/SPM_uploadimage",a).then((function(e){return e.text()})).then((function(e){t.uploading=!1,t.imageUrl=e,t.newUserInfo.avatar=e,console.log(e)})).catch((function(e){console.log("error",e),t.uploading=!1}))}}},handleSubmit:function(e){var t=this;this.loading=!0,e.preventDefault(),this.form.validateFieldsAndScroll((function(e,n){if(e)t.loading=!1,console.log(2);else{var r=Object(u["a"])({},n);r.avatar=t.imageUrl,console.log(1);var a=new Headers;a.append("token",Object(i["c"])()),a.append("Content-Type","application/json"),console.log(r);var o={method:"PUT",headers:a,body:JSON.stringify(r)};fetch("".concat(t.$global.BASE_URL,"/api/admin/user/update"),o).then((function(e){return e.json()})).then((function(e){console.log(e),0==e.code||"0"==e.code?(t.loading=!1,t.$message.success("Update user successfully"),Object(i["h"])(),t.$router.go("/user")):(t.loading=!1,t.$message.error("API call error, "+e.msg))})).catch((function(e){console.log("error",e),t.loading=!1,t.$messge.error("API call error.")}))}}))},handleConfirmBlur:function(e){var t=e.target.value;this.confirmDirty=this.confirmDirty||!!t},compareToFirstPassword:function(e,t,n){var r=this.form;t&&t!==r.getFieldValue("password")?n("Two passwords that you enter is inconsistent!"):n()},validateToNextPassword:function(e,t,n){var r=this.form;t&&this.confirmDirty&&r.validateFields(["confirm"],{force:!0}),n()}},filter:function(e,t){return t.some((function(t){return t.label.toLowerCase().indexOf(e.toLowerCase())>-1}))}},p=d,m=(n("177c"),n("2877")),f=Object(m["a"])(p,s,l,!1,null,null,null),g=f.exports,h=n("658f5"),v=n.n(h),b=n("c1df"),w=n.n(b),y={name:"UserCenter",components:{EditProfile:g,VueQr:v.a},data:function(){return{contentNumber:1,notifications:[],userInfo:{user_id:"",id:"",name:"",gender:"",position:"",phone_number:"",email:"",avatar:""},confirmDirty:!1,autoCompleteResult:[],formItemLayout:{labelCol:{xs:{span:27},sm:{span:9}},wrapperCol:{xs:{span:12},sm:{span:8}}},tailFormItemLayout:{wrapperCol:{xs:{span:27,offset:0},sm:{span:16,offset:9}}}}},beforeCreate:function(){this.form=this.$form.createForm(this,{name:"编辑"})},created:function(){this.getUserInfo(),this.getNotifications()},methods:{handleSubmit:function(e){var t=this,n=this;this.loading=!0,e.preventDefault(),this.form.validateFieldsAndScroll((function(e,r){var a={user_id:t.userInfo.user_id,id:t.userInfo.id,name:r.nickname,gender:r.gender,position:r.position,phone_number:r.phone,email:r.email,avatar:t.userInfo.avatar};if(console.log(a),e)t.loading=!1;else{var o=new Headers({"Content-Type":"application/json"});o.append("token",Object(i["c"])());var s={headers:o,method:"POST",body:JSON.stringify(a)};fetch("".concat(n.$global.BASE_URL,"/api/user/profile/edit"),s).then((function(e){return e.json()})).then((function(e){console.log(e),0==e.code||"0"==e.code?(n.loading=!1,n.$message.success("success","Edit successfully"),t.contentNumber=1):(n.loading=!1,n.$message.error(e.msg))})).catch((function(e){console.log("error",e),n.loading=!1,n.$messge.error("API call error.")}))}}))},changeContent:function(e){this.contentNumber=e},handleLogout:function(){Object(i["g"])(),this.$global.IS_LOGIN=!1,this.userInfo={},this.$router.to("/login")},getUserInfo:function(){this.loading=!0,this.userInfo.avatar=Object(i["d"])().avatar;var e=new Headers({"Content-Type":"application/json"});e.append("token",Object(i["c"])()),console.log;var t={method:"GET",headers:e},n=this;fetch("http://101.43.38.236:8085/api/user/profile/detail",t).then((function(e){return e.json()})).then((function(e){console.log(e),n.userInfo.id=e.data.id,n.userInfo.name=e.data.name,n.userInfo.gender=e.data.gender,n.userInfo.position=e.data.position,n.userInfo.phone_number=e.data.phone_number,n.userInfo.email=e.data.email,n.userInfo.user_id=e.data.user_id,n.userInfo.borrowing=e.data.borrowings,n.userInfo.maxBorrowing=e.data.max_borrowing})).catch((function(e){return console.log("error",e)}))},type2url:function(e,t){if(1===e||3===e||5===e)return"/user/borrowing/".concat(t,"/detail")},goto:function(e){this.$router.push(e)},getNotifications:function(){this.loading=!0;var e=new Headers({"Content-Type":"application/json"});e.append("token",Object(i["c"])()),console.log;var t={method:"GET"},n=this;fetch("".concat(this.$global.EXTRA_FUNCTION,"/getnotifications?user_id=").concat(Object(i["d"])().user_id),t).then((function(e){return e.json()})).then((function(e){console.log(e),200==e.code&&setTimeout((function(){var t,r=Object(o["a"])(e.list);try{for(r.s();!(t=r.n()).done;){var a=t.value,i=a.type,s=a.id,l=n.type2url(i,s);n.notifications.push({title:a.title,content:a.content,url:l,time:w()(a.time).fromNow()})}}catch(u){r.e(u)}finally{r.f()}n.loading=!1}),200)})).catch((function(e){return console.log("error",e)}))}}},_=y,x=Object(m["a"])(_,r,a,!1,null,null,null);t["default"]=x.exports},"42bb":function(e,t,n){},"44e7":function(e,t,n){var r=n("861d"),a=n("c6b6"),o=n("b622"),i=o("match");e.exports=function(e){var t;return r(e)&&(void 0!==(t=e[i])?!!t:"RegExp"==a(e))}},"8aa5":function(e,t,n){"use strict";var r=n("6547").charAt;e.exports=function(e,t,n){return t+(n?r(e,t).length:1)}},d784:function(e,t,n){"use strict";n("ac1f");var r=n("e330"),a=n("6eeb"),o=n("9263"),i=n("d039"),s=n("b622"),l=n("9112"),u=s("species"),c=RegExp.prototype;e.exports=function(e,t,n,d){var p=s(e),m=!i((function(){var t={};return t[p]=function(){return 7},7!=""[e](t)})),f=m&&!i((function(){var t=!1,n=/a/;return"split"===e&&(n={},n.constructor={},n.constructor[u]=function(){return n},n.flags="",n[p]=/./[p]),n.exec=function(){return t=!0,null},n[p](""),!t}));if(!m||!f||n){var g=r(/./[p]),h=t(p,""[e],(function(e,t,n,a,i){var s=r(e),l=t.exec;return l===o||l===c.exec?m&&!i?{done:!0,value:g(t,n,a)}:{done:!0,value:s(n,t,a)}:{done:!1}}));a(String.prototype,e,h[0]),a(c,p,h[1])}d&&l(c[p],"sham",!0)}}}]);
//# sourceMappingURL=chunk-d9f96d9e.45cfed39.js.map